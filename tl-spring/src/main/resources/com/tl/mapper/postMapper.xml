<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tl.mapper.PostMapper">
	
	<!-- 게시물 글쓰기  -->
	<!-- REPLY, MEDIA 어떻게 처리하는지 고민 PAGE는 안넘기고 -->
	<insert id = "write">
	INSERT INTO post(category, title, content, memberId,media )
	values(#{category},#{title},#{content},#{memberId}, #{media})	
	</insert>
	
	
	<select id="getReviewList" resultType="com.tl.dto.PostDto">
  SELECT * FROM post 
  WHERE category='reviewBoard'
  <if test="lastNo != 0">
    AND no <![CDATA[ < ]]> #{lastNo}
  </if>
  ORDER BY no DESC
  LIMIT #{pageSize}
</select>
  
  <select id="getFreeList" resultType="com.tl.dto.PostDto">
    SELECT * FROM post where category='freeBoard'
	</select>
	
	<select id="getTotalPosts" resultType="Long">
    SELECT COUNT(*) FROM post
</select>
	
	<!-- 게시물 클릭 하면 게시물 넘버로 셀렉트  -->
	<select id="read" resultType ="com.tl.dto.PostDto">
	SELECT*FROM post where no = #{no}
	</select>
	
	<!-- 게시물 지우기하면 게시물 넘버로 셀렉트  -->
	<delete id="delete">
	DELETE FROM post where no = #{no}
	</delete>
	<!-- DB에서 liked는 default 1 -->
	<insert id="addLike">
	INSERT INTO liked(memberId,postNo,liked)
	VALUES(#{memberId},#{postNo},1)
	</insert>
	
	<update id="handleLike">
	UPDATE liked SET liked=#{liked} WHERE memberId=#{memberId} AND postNo=#{postNo}
	</update>
	
	<select id="countLikes" resultType="int">
	SELECT COUNT(*) FROM liked WHERE postNo=#{postNo} AND liked = 1
	</select>
	
	<select id="getLike" resultType="com.tl.dto.LikeDTO">
	SELECT*FROM liked where memberId=#{memberId} and postNo=#{postNo}
	</select>
	
</mapper>